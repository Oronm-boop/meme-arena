<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.title}} - Meme Arena</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸª {{.title}}</h1>
            <a href="/admin" class="btn">â† è¿”å›åˆ—è¡¨</a>
        </header>

        <main>
            <form method="POST" action="/admin/save" class="config-form">
                <!-- æ—¥æœŸé€‰æ‹© -->
                <div class="form-section">
                    <h2>ğŸ“… é…ç½®æ—¥æœŸ</h2>
                    <div class="form-group">
                        <label for="date">æ—¥æœŸ</label>
                        <input type="date" id="date" name="date" value="{{.config.Date}}" required>
                        <small>é€‰æ‹©è¦é…ç½®çš„æ—¥æœŸï¼Œå‰ç«¯ä¼šæ ¹æ®æ—¥æœŸè‡ªåŠ¨è·å–å¯¹åº”é…ç½®</small>
                    </div>
                </div>

                <!-- çº¢é˜Ÿé…ç½® -->
                <div class="form-section team-a">
                    <h2>ğŸ”´ çº¢é˜Ÿ (Team A)</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="team_a_name">è§’è‰²åç§°</label>
                            <input type="text" id="team_a_name" name="team_a_name" value="{{.config.TeamAName}}" placeholder="å¦‚ï¼šè”¡å¾å¤">
                        </div>
                        <div class="form-group">
                            <label for="team_a_title">ç§°å·</label>
                            <input type="text" id="team_a_title" name="team_a_title" value="{{.config.TeamATitle}}" placeholder="å¦‚ï¼šç»ƒä¹ ç”Ÿ">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="team_a_slogan">å£å·/å°è¯</label>
                        <input type="text" id="team_a_slogan" name="team_a_slogan" value="{{.config.TeamASlogan}}" placeholder="å¦‚ï¼šé¸¡ä½ å¤ªç¾...">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="team_a_image">ä¸»å›¾ URL</label>
                            <div class="upload-group">
                                <input type="url" id="team_a_image" name="team_a_image" value="{{.config.TeamAImage}}" placeholder="https://...">
                                <button type="button" class="btn btn-small" onclick="uploadImage('team_a_image')">ä¸Šä¼ </button>
                            </div>
                            <div id="team_a_image_preview" class="image-preview"></div>
                        </div>
                        <div class="form-group">
                            <label for="team_a_color">ä¸»é¢˜è‰²</label>
                            <input type="color" id="team_a_color" name="team_a_color" value="{{if .config.TeamAColor}}{{.config.TeamAColor}}{{else}}#ec4899{{end}}">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="team_a_memes">è¡¨æƒ…åŒ… URLsï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                        <textarea id="team_a_memes" name="team_a_memes" rows="4" placeholder="https://example.com/meme1.jpg&#10;https://example.com/meme2.jpg">{{.config.TeamAMemes}}</textarea>
                        <div class="upload-btn-row">
                            <button type="button" class="btn btn-small" onclick="uploadMemes('team_a_memes')">æ‰¹é‡ä¸Šä¼ è¡¨æƒ…åŒ…</button>
                        </div>
                    </div>
                </div>

                <!-- è“é˜Ÿé…ç½® -->
                <div class="form-section team-b">
                    <h2>ğŸ”µ è“é˜Ÿ (Team B)</h2>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="team_b_name">è§’è‰²åç§°</label>
                            <input type="text" id="team_b_name" name="team_b_name" value="{{.config.TeamBName}}" placeholder="å¦‚ï¼šèŒƒå°å‹¤">
                        </div>
                        <div class="form-group">
                            <label for="team_b_title">ç§°å·</label>
                            <input type="text" id="team_b_title" name="team_b_title" value="{{.config.TeamBTitle}}" placeholder="å¦‚ï¼šæŒ–æ˜æœº">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="team_b_slogan">å£å·/å°è¯</label>
                        <input type="text" id="team_b_slogan" name="team_b_slogan" value="{{.config.TeamBSlogan}}" placeholder="å¦‚ï¼šæˆ‘è¦å¼€å‘5G...">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="team_b_image">ä¸»å›¾ URL</label>
                            <div class="upload-group">
                                <input type="url" id="team_b_image" name="team_b_image" value="{{.config.TeamBImage}}" placeholder="https://...">
                                <button type="button" class="btn btn-small" onclick="uploadImage('team_b_image')">ä¸Šä¼ </button>
                            </div>
                            <div id="team_b_image_preview" class="image-preview"></div>
                        </div>
                        <div class="form-group">
                            <label for="team_b_color">ä¸»é¢˜è‰²</label>
                            <input type="color" id="team_b_color" name="team_b_color" value="{{if .config.TeamBColor}}{{.config.TeamBColor}}{{else}}#3b82f6{{end}}">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="team_b_memes">è¡¨æƒ…åŒ… URLsï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                        <textarea id="team_b_memes" name="team_b_memes" rows="4" placeholder="https://example.com/meme1.jpg&#10;https://example.com/meme2.jpg">{{.config.TeamBMemes}}</textarea>
                        <div class="upload-btn-row">
                            <button type="button" class="btn btn-small" onclick="uploadMemes('team_b_memes')">æ‰¹é‡ä¸Šä¼ è¡¨æƒ…åŒ…</button>
                        </div>
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary btn-large">ğŸ’¾ ä¿å­˜é…ç½®</button>
                    <a href="/admin" class="btn btn-large">å–æ¶ˆ</a>
                </div>
            </form>
        </main>
    </div>

    <!-- éšè—çš„æ–‡ä»¶ä¸Šä¼ input -->
    <input type="file" id="fileInput" accept="image/*" style="display:none">
    <input type="file" id="filesInput" accept="image/*" multiple style="display:none">

    <script>
        let currentTargetField = null;

        // å•ä¸ªå›¾ç‰‡ä¸Šä¼ 
        function uploadImage(targetFieldId) {
            currentTargetField = targetFieldId;
            document.getElementById('fileInput').click();
        }

        // æ‰¹é‡ä¸Šä¼ è¡¨æƒ…åŒ…
        function uploadMemes(targetFieldId) {
            currentTargetField = targetFieldId;
            document.getElementById('filesInput').click();
        }

        // å•æ–‡ä»¶ä¸Šä¼ å¤„ç†
        document.getElementById('fileInput').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (data.url) {
                    document.getElementById(currentTargetField).value = data.url;
                    // æ˜¾ç¤ºé¢„è§ˆ
                    const previewDiv = document.getElementById(currentTargetField + '_preview');
                    if (previewDiv) {
                        previewDiv.innerHTML = '<img src="' + data.url + '" alt="é¢„è§ˆ">';
                    }
                    alert('ä¸Šä¼ æˆåŠŸï¼');
                } else {
                    alert('ä¸Šä¼ å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                alert('ä¸Šä¼ å‡ºé”™: ' + error.message);
            }

            e.target.value = ''; // æ¸…ç©ºinput
        });

        // å¤šæ–‡ä»¶ä¸Šä¼ å¤„ç†
        document.getElementById('filesInput').addEventListener('change', async function(e) {
            const files = e.target.files;
            if (!files.length) return;

            const formData = new FormData();
            for (let i = 0; i < files.length; i++) {
                formData.append('files', files[i]);
            }

            try {
                const response = await fetch('/api/upload/batch', {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (data.urls && data.urls.length > 0) {
                    const textarea = document.getElementById(currentTargetField);
                    const existingUrls = textarea.value.trim();
                    const newUrls = data.urls.join('\n');
                    textarea.value = existingUrls ? existingUrls + '\n' + newUrls : newUrls;
                    alert('æˆåŠŸä¸Šä¼  ' + data.count + ' ä¸ªæ–‡ä»¶ï¼');
                } else {
                    alert('ä¸Šä¼ å¤±è´¥: ' + (data.message || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                alert('ä¸Šä¼ å‡ºé”™: ' + error.message);
            }

            e.target.value = ''; // æ¸…ç©ºinput
        });

        // å›¾ç‰‡é¢„è§ˆåŠŸèƒ½
        document.querySelectorAll('input[type="url"]').forEach(input => {
            input.addEventListener('change', function() {
                const url = this.value;
                const previewDiv = document.getElementById(this.id + '_preview');
                if (previewDiv && url) {
                    previewDiv.innerHTML = '<img src="' + url + '" alt="é¢„è§ˆ" onerror="this.parentElement.innerHTML=\'åŠ è½½å¤±è´¥\'">';
                }
            });

            // åˆå§‹åŒ–é¢„è§ˆ
            if (input.value) {
                const previewDiv = document.getElementById(input.id + '_preview');
                if (previewDiv) {
                    previewDiv.innerHTML = '<img src="' + input.value + '" alt="é¢„è§ˆ" onerror="this.parentElement.innerHTML=\'åŠ è½½å¤±è´¥\'">';
                }
            }
        });
    </script>
</body>
</html>
